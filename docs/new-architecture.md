## 一、整体系统架构图（逻辑架构）

```
┌──────────────────────────────────────────────┐
│                  Client 层                   │
│                                              │
│  ┌────────────┐    ┌─────────────────────┐  │
│  │ 前台系统    │    │ 管理后台 Admin      │  │
│  │ React/Angular│   │ React/Angular       │  │
│  └────────────┘    └─────────────────────┘  │
│                                              │
└───────────────────────────▲──────────────────┘
                            │ HTTPS / REST
                            ▼
┌──────────────────────────────────────────────┐
│                API Gateway                   │
│                                              │
│  - 路由转发                                  │
│  - 统一鉴权校验                              │
│  - 限流 / 日志                               │
│                                              │
└───────────────────────────▲──────────────────┘
                            │ JWT / OAuth2
                            ▼
┌──────────────────────────────────────────────┐
│                Auth Service                  │
│                                              │
│  - 用户登录                                  │
│  - 角色 & 权限                               │
│  - Token 签发                                │
│                                              │
└───────────────────────────▲──────────────────┘
                            │
                            ▼
┌──────────────────────────────────────────────────────────────────┐
│                         业务服务层                               │
│                                                                  │
│ ┌──────────────┐  ┌──────────────┐  ┌────────────────────────┐ │
│ │ Hotel Service│  │ Room Service │  │ Booking Service         │ │
│ │              │  │              │  │                        │ │
│ │ - 酒店信息   │  │ - 房型       │  │ - 预订创建             │ │
│ │ - 配置规则   │  │ - 房间       │  │ - 订单状态流转         │ │
│ └──────────────┘  └──────────────┘  └────────────────────────┘ │
│                                                                  │
│ ┌──────────────┐  ┌──────────────┐  ┌────────────────────────┐ │
│ │ Stay Service │  │ Billing Svc  │  │ Report Service          │ │
│ │              │  │              │  │                        │ │
│ │ - 入住       │  │ - 账单       │  │ - 入住率               │ │
│ │ - 退房       │  │ - 支付       │  │ - RevPAR               │ │
│ └──────────────┘  └──────────────┘  └────────────────────────┘ │
│                                                                  │
└───────────────▲────────────────────▲────────────────────▲───────┘
                │                    │                    │
                ▼                    ▼                    ▼
┌──────────────────────┐  ┌──────────────────────┐  ┌────────────────────┐
│      PostgreSQL      │  │        Redis         │  │   Message Queue     │
│                      │  │                      │  │   (Kafka / Redis)  │
│ - 订单               │  │ - 房态库存           │  │ - 异步事件         │
│ - 房间               │  │ - Session            │  │ - 订单超时         │
│ - 入住记录           │  │ - 分布式锁           │  │                    │
└──────────────────────┘  └──────────────────────┘  └────────────────────┘

```

---

## 二、你在面试时可以这样讲（重点）

### 1️⃣ 为什么要 API Gateway？

> “所有客户端请求统一经过 Gateway，便于做鉴权、限流和日志，同时业务服务保持纯粹。”

**关键词**：

* 单一入口
* 横切关注点
* 微服务友好

---

### 2️⃣ Auth Service 单独拆的原因

> “酒店系统角色非常复杂（前台、财务、管理员），权限变化频繁，独立 Auth 服务更可维护。”

**技术点**：

* JWT
* RBAC
* Spring Security 6 / OAuth2

---

### 3️⃣ Booking / Room / Stay 为什么要拆？

| 服务              | 职责               |
| --------------- | ---------------- |
| Room Service    | **静态资源**（房型、房间）  |
| Booking Service | **高并发**（库存、下单）   |
| Stay Service    | **线下操作强**（入住、换房） |

👉 面试官会很认可你对 **“变化频率不同 → 服务拆分”** 的理解。

---

### 4️⃣ Redis 在系统中的位置（高分点）

```
下单 → Redis 预扣库存 → DB 落单 → 成功后确认
```

你可以说：

> “Redis 主要用于房型库存按日维度的预扣，避免数据库在高并发下被直接打穿。”

---

### 5️⃣ 异步 & 定时任务设计

**典型场景**

* 未支付订单 15 分钟自动取消
* 退房后触发账单结算
* 夜审（Daily Close）

**实现**

* MQ 事件
* Quartz / K8s CronJob

---

## 三、部署架构（K8s 视角）

```
┌──────────────┐
│ Ingress/Nginx│
└───────▲──────┘
        │
┌───────┴───────────┐
│ API Gateway Pod   │
└───────▲───────────┘
        │
┌───────┴──────────────────────────────────────┐
│ Auth | Booking | Room | Stay | Billing Pods  │
│ (HPA 自动扩缩容)                              │
└───────▲──────────────────────────────────────┘
        │
┌───────┴───────────────┐
│ PostgreSQL / Redis    │
│ (StatefulSet)         │
└───────────────────────┘
```



